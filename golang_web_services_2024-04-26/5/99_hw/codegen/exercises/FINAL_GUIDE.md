# –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∑–∞–¥–∞–Ω–∏—è

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —Ç—ã –∏–∑—É—á–∏–ª –≤—Å–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è, —Ç—ã –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è! –í–æ—Ç –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω:

## –ß—Ç–æ —Ç—ã —É–∂–µ –∑–Ω–∞–µ—à—å

–ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π —Ç—ã –ø–æ–Ω–∏–º–∞–µ—à—å:

1. **AST –≤ Go** - –∫–∞–∫ –ø–∞—Ä—Å–∏—Ç—å –∫–æ–¥ –∏ –∏–∑–≤–ª–µ–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
2. **–°—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–µ —Ç–µ–≥–∏** - –∫–∞–∫ –∏–∑–≤–ª–µ–∫–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
3. **–ü–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤** - –∫–∞–∫ –Ω–∞—Ö–æ–¥–∏—Ç—å –º–µ—Ç–∫–∏ `apigen:api`
4. **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ–¥–∞** - –∫–∞–∫ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–¥ —Å –ø–æ–º–æ—â—å—é —à–∞–±–ª–æ–Ω–æ–≤

## –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è

### –®–∞–≥ 1: –ê–Ω–∞–ª–∏–∑ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π

–¢–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∫–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π:

1. **–ù–∞—Ö–æ–¥–∏—Ç –º–µ—Ç–æ–¥—ã** —Å –º–µ—Ç–∫–æ–π `apigen:api`
2. **–ò–∑–≤–ª–µ–∫–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é** –∏–∑ JSON –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
3. **–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤** –∏ –∏—Ö —Ç–µ–≥–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
4. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTTP-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏** —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
5. **–°–æ–∑–¥–∞–µ—Ç ServeHTTP –º–µ—Ç–æ–¥** –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏

### –®–∞–≥ 2: –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞

–°–æ–∑–¥–∞–π —Ñ–∞–π–ª `handlers_gen/codegen.go` —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

```go
package main

import (
    "encoding/json"
    "fmt"
    "go/ast"
    "go/parser"
    "go/token"
    "log"
    "os"
    "reflect"
    "strings"
    "text/template"
)

// –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
type ApiConfig struct {
    URL    string `json:"url"`
    Auth   bool   `json:"auth"`
    Method string `json:"method"`
}

type ValidationRule struct {
    Required  bool
    Min       int
    Max       int
    Enum      []string
    Default   string
    ParamName string
}

type MethodInfo struct {
    StructName string
    MethodName string
    URL        string
    Auth       bool
    Method     string
    Params     []ParamInfo
}

type ParamInfo struct {
    Name       string
    Type       string
    Required   bool
    Min        int
    Max        int
    Enum       []string
    Default    string
    ParamName  string
}

func main() {
    if len(os.Args) != 3 {
        log.Fatal("Usage: codegen <input_file> <output_file>")
    }
    
    inputFile := os.Args[1]
    outputFile := os.Args[2]
    
    err := generateCode(inputFile, outputFile)
    if err != nil {
        log.Fatal(err)
    }
}
```

### –®–∞–≥ 3: –§—É–Ω–∫—Ü–∏–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞

–î–æ–±–∞–≤—å —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–π:

```go
func parseValidationTag(tag string) ValidationRule {
    // –ö–æ–¥ –∏–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è 2
}

func parseApiComment(comment string) (*ApiConfig, error) {
    // –ö–æ–¥ –∏–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è 3
}

func findStructByName(node *ast.File, structName string) *ast.StructType {
    // –ö–æ–¥ –∏–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è 5
}
```

### –®–∞–≥ 4: –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

```go
func generateCode(inputFile, outputFile string) error {
    // 1. –ü–∞—Ä—Å–∏–º –≤—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª
    fset := token.NewFileSet()
    node, err := parser.ParseFile(fset, inputFile, nil, parser.ParseComments)
    if err != nil {
        return err
    }
    
    // 2. –°–æ–±–∏—Ä–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ç–æ–¥–∞—Ö
    var methods []MethodInfo
    // ... –∫–æ–¥ –∏–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è 5
    
    // 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–æ–¥
    out, err := os.Create(outputFile)
    if err != nil {
        return err
    }
    defer out.Close()
    
    // 4. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –∏–º–ø–æ—Ä—Ç—ã
    // 5. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ServeHTTP –º–µ—Ç–æ–¥
    // 6. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–µ—Ç–æ–¥–∞
    
    return nil
}
```

### –®–∞–≥ 5: –®–∞–±–ª–æ–Ω—ã –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

–ò—Å–ø–æ–ª—å–∑—É–π —à–∞–±–ª–æ–Ω—ã –∏–∑ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è 4, –Ω–æ –∞–¥–∞–ø—Ç–∏—Ä—É–π –∏—Ö –ø–æ–¥ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è:

1. **ServeHTTP –º–µ—Ç–æ–¥** - –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ URL
2. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–µ—Ç–æ–¥–æ–≤** - –≤–∞–ª–∏–¥–∞—Ü–∏—è, –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–æ–≤
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ ApiError –∏ –æ–±—â–∏—Ö –æ—à–∏–±–æ–∫

### –®–∞–≥ 6: –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞–¥–∞–Ω–∏—è

–û–±—Ä–∞—Ç–∏ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `X-Auth: 100500`
2. **–í–∞–ª–∏–¥–∞—Ü–∏—è** - –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –∏–∑ —Ç–µ–≥–æ–≤ `apivalidator`
3. **–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞** - JSON —Å –ø–æ–ª—è–º–∏ `error` –∏ `response`
4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ HTTP —Å—Ç–∞—Ç—É—Å—ã
5. **–ü–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫** - –º–µ—Ç–æ–¥ ‚Üí –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Üí –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

### –®–∞–≥ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–°–æ–±–µ—Ä–∏ –∫–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä**:
   ```bash
   go build handlers_gen/* && ./codegen api.go api_handlers.go
   ```

2. **–ó–∞–ø—É—Å—Ç–∏ —Ç–µ—Å—Ç—ã**:
   ```bash
   go test -v
   ```

3. **–ò—Å–ø—Ä–∞–≤–ª—è–π –æ—à–∏–±–∫–∏** –ø–æ –º–µ—Ä–µ –∏—Ö –ø–æ—è–≤–ª–µ–Ω–∏—è

## –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã –¥–ª—è —É—Å–ø–µ—Ö–∞

### 1. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫
```go
// 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç–æ–¥–∞ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω)
if r.Method != "POST" {
    http.Error(w, "Method not allowed", http.StatusMethodNotAllowed)
    return
}

// 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è)
if r.Header.Get("X-Auth") != "100500" {
    http.Error(w, "Unauthorized", http.StatusUnauthorized)
    return
}

// 3. –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–≤ –ø–æ—Ä—è–¥–∫–µ –ø–æ–ª–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã)
```

### 2. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫
```go
// –î–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
http.Error(w, "login must me not empty", http.StatusBadRequest)

// –î–ª—è ApiError
if apiErr, ok := err.(ApiError); ok {
    http.Error(w, apiErr.Error(), apiErr.HTTPStatus)
    return
}

// –î–ª—è –æ–±—â–∏—Ö –æ—à–∏–±–æ–∫
http.Error(w, err.Error(), http.StatusInternalServerError)
```

### 3. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
```go
w.Header().Set("Content-Type", "application/json")
json.NewEncoder(w).Encode(map[string]interface{}{
    "error": "",
    "response": result,
})
```

## –û—Ç–ª–∞–¥–∫–∞

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–î–æ–±–∞–≤–ª—è–π –æ—Ç–ª–∞–¥–æ—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã**:
   ```go
   fmt.Printf("–ù–∞–π–¥–µ–Ω –º–µ—Ç–æ–¥: %s\n", methodName)
   fmt.Printf("–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: %+v\n", params)
   ```

2. **–ü—Ä–æ–≤–µ—Ä—è–π —Ç–∏–ø—ã**:
   ```go
   fmt.Printf("type: %T, value: %+v\n", value, value)
   ```

3. **–¢–µ—Å—Ç–∏—Ä—É–π –ø–æ —á–∞—Å—Ç—è–º** - —Å–Ω–∞—á–∞–ª–∞ –ø–∞—Ä—Å–∏–Ω–≥, –ø–æ—Ç–æ–º –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

## –ì–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è

–ï—Å–ª–∏ –∑–∞—Å—Ç—Ä—è–Ω–µ—à—å, –º–æ–∂–µ—à—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞:
- `exercise5_complete_codegen.go` - –ø–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä
- `example/gen/codegen.go` - –ø—Ä–∏–º–µ—Ä –∏–∑ –ª–µ–∫—Ü–∏–∏
- –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ –≤ `test_handlers.go`

## –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

–ü–µ—Ä–µ–¥ —Å–¥–∞—á–µ–π —É–±–µ–¥–∏—Å—å, —á—Ç–æ:

1. ‚úÖ –ö–æ–¥–æ–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
2. ‚úÖ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∫–æ–¥
3. ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
4. ‚úÖ –ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ (MyApi, OtherApi)
5. ‚úÖ –í—Å–µ –ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è
6. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞

–£–¥–∞—á–∏! –¢—ã –≥–æ—Ç–æ–≤ –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∑–∞–¥–∞–Ω–∏—è! üöÄ