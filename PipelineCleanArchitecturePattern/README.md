# üèóÔ∏è Pipeline Clean Architecture Pattern

**–ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Clean Architecture —Å Pipeline Pattern –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ e-commerce –∑–∞–∫–∞–∑–æ–≤**

## üéØ –û –ø—Ä–æ–µ–∫—Ç–µ

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **–ø–æ–ª–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é Clean Architecture –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å Pipeline Pattern**. –°–æ–∑–¥–∞–Ω –∫–∞–∫ –æ–±—Ä–∞–∑—Ü–æ–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –Ω–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–º –ø—Ä–∏–º–µ—Ä–µ.

### üí° –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

- ‚úÖ **–ü–æ–ª–Ω–∞—è Clean Architecture** —Å 4 —Å–ª–æ—è–º–∏
- ‚úÖ **Pipeline Engine** –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–ª–æ–∂–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤  
- ‚úÖ **E-commerce —Å–∏—Å—Ç–µ–º–∞** –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤
- ‚úÖ **–ë–æ–≥–∞—Ç—ã–µ –¥–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏** —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
- ‚úÖ **–†–∞–±–æ—Ç–∞—é—â–∏–µ –ø–∞–π–ø–ª–∞–π–Ω—ã** —Å 4 —à–∞–≥–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è** –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –î–∏–∞–≥—Ä–∞–º–º–∞ —Å–ª–æ–µ–≤

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 üåê INTERFACE LAYER                      ‚îÇ
‚îÇ             cmd/api, cmd/worker, cmd/pipeline           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                üöÄ APPLICATION LAYER                     ‚îÇ
‚îÇ     internal/application/pipeline + pkg/pipeline       ‚îÇ
‚îÇ         Pipeline Engine, Steps, Services               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  üíº USE CASE LAYER                      ‚îÇ
‚îÇ              internal/usecase/order_processing          ‚îÇ
‚îÇ           Interfaces, DTOs, Business Processes         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   üèõÔ∏è DOMAIN LAYER                       ‚îÇ
‚îÇ        internal/domain/order, payment, product         ‚îÇ
‚îÇ          Entities, Value Objects, Business Rules       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                               ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               üîß INFRASTRUCTURE LAYER                   ‚îÇ
‚îÇ            internal/infrastructure/* (–º–æ–∫–∏)            ‚îÇ
‚îÇ       Database, External Services, HTTP Clients        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üîÑ Pipeline –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞

```mermaid
graph TD
    A[üìù –ù–æ–≤—ã–π –∑–∞–∫–∞–∑] --> B[‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–∫–∞–∑–∞]
    B --> C[üí∞ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞]
    C --> D[üì¶ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–ª–∞–¥–∞]
    D --> E[üìß –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π]
    E --> F[‚ú® –ó–∞–∫–∞–∑ –æ–±—Ä–∞–±–æ—Ç–∞–Ω]
    
    B --> G[‚ùå –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏]
    C --> H[‚ùå –û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞]
    D --> I[‚ùå –ù–µ—Ç —Ç–æ–≤–∞—Ä–∞ –Ω–∞ —Å–∫–ª–∞–¥–µ]
    E --> J[‚ùå –û—à–∏–±–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π]
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
pipeline-clean-architecture/
‚îú‚îÄ‚îÄ üöÄ cmd/                          # –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ api/main.go                  # HTTP API —Å–µ—Ä–≤–µ—Ä (–±—É–¥—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ worker/main.go               # Background –≤–æ—Ä–∫–µ—Ä (–±—É–¥—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
‚îÇ   ‚îî‚îÄ‚îÄ pipeline/main.go             # üéØ –î–ï–ú–û: –ó–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞
‚îú‚îÄ‚îÄ üîí internal/                     # –í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –ª–æ–≥–∏–∫–∞ (–Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è)
‚îÇ   ‚îú‚îÄ‚îÄ üèõÔ∏è domain/                   # –î–û–ú–ï–ù–ù–´–ô –°–õ–û–ô
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ order/                   # –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –∑–∞–∫–∞–∑–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entity.go           # ‚ú® –°—É—â–Ω–æ—Å—Ç—å Order —Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ repository.go       # üìã –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment/                 # –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ø–ª–∞—Ç–µ–∂–∞
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ entity.go           # ‚ú® –°—É—â–Ω–æ—Å—Ç—å Payment
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ product/                 # –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ entity.go           # ‚ú® –°—É—â–Ω–æ—Å—Ç—å Product
‚îÇ   ‚îú‚îÄ‚îÄ üíº usecase/                  # USE CASE –°–õ–û–ô
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ order_processing/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ interfaces.go       # üìã –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ üöÄ application/              # APPLICATION –°–õ–û–ô
‚îÇ       ‚îî‚îÄ‚îÄ pipeline/
‚îÇ           ‚îî‚îÄ‚îÄ order_steps.go      # üîÑ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞
‚îú‚îÄ‚îÄ üì¶ pkg/                          # –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ pipeline/
‚îÇ       ‚îî‚îÄ‚îÄ engine.go               # üéØ CORE: Pipeline Engine
‚îú‚îÄ‚îÄ üìù configs/                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ üìö docs/                         # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
    ‚îî‚îÄ‚îÄ ARCHITECTURE_GUIDE.md       # üìñ –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
```

## üéÆ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd PipelineCleanArchitecturePattern

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
go mod download
```

### 2. –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å–∫–∞–µ–º –¥–µ–º–æ –ø–∞–π–ø–ª–∞–π–Ω–∞
go run cmd/pipeline/main.go
```

### 3. –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

```
üöÄ Starting Pipeline Clean Architecture Demo
üìã Created test order order_id=xxx customer_id=xxx items_count=2
üîÑ Starting pipeline execution pipeline=order_processing
‚úÖ Step completed successfully: validate_order duration=15ms
üí∞ Processing payment for order xxx
‚úÖ Step completed successfully: process_payment duration=25ms  
üì¶ Checking inventory for order xxx
‚úÖ Step completed successfully: check_inventory duration=12ms
üìß EMAIL SENT to customer@example.com: –ó–∞–∫–∞–∑ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
üì± SMS SENT to +7900123456789: –ó–∞–∫–∞–∑ xxx –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω
‚úÖ Step completed successfully: send_notifications duration=8ms
‚úÖ Pipeline execution completed successfully! status=completed total_duration=60ms
üì¶ Final order status: inventory_checked
üéâ Demo completed successfully!
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. üèõÔ∏è Domain Layer (–î–æ–º–µ–Ω–Ω—ã–π —Å–ª–æ–π)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `internal/domain/`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–æ–¥–µ—Ä–∂–∏—Ç —á–∏—Å—Ç—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –±–µ–∑ –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- **Order Entity** (`order/entity.go`) - –ó–∞–∫–∞–∑ —Å –º–µ—Ç–æ–¥–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏, –æ—Ç–º–µ–Ω—ã, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- **Payment Entity** (`payment/entity.go`) - –ü–ª–∞—Ç–µ–∂ —Å –ª–æ–≥–∏–∫–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤  
- **Product Entity** (`product/entity.go`) - –¢–æ–≤–∞—Ä —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —Å–∫–ª–∞–¥–æ–º –∏ —Ü–µ–Ω–∞–º–∏
- **Repository Interfaces** - –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏

```go
// –ü—Ä–∏–º–µ—Ä: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤ –¥–æ–º–µ–Ω–Ω–æ–π —Å—É—â–Ω–æ—Å—Ç–∏
func (o *Order) CanCancel() bool {
    return o.status != StatusShipped && 
           o.status != StatusDelivered
}

func (o *Order) Cancel() error {
    if !o.CanCancel() {
        return errors.New("cannot cancel order in current status")
    }
    o.status = StatusCancelled
    return nil
}
```

### 2. üíº Use Case Layer (–°–ª–æ–π —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `internal/usecase/`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- **OrderProcessor** - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–æ–≤
- **PipelineExecutor** - –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
- **Request/Response DTOs** - –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö

### 3. üöÄ Application Layer (–°–ª–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `internal/application/` –∏ `pkg/pipeline/`

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**:
- **Pipeline Engine** (`pkg/pipeline/engine.go`) - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫ –ø–∞–π–ø–ª–∞–π–Ω–æ–≤
- **Pipeline Steps** (`internal/application/pipeline/order_steps.go`) - –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–∫–∞–∑–∞

### 4. üîß Infrastructure Layer (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–π)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `cmd/pipeline/main.go` (–º–æ–∫–∏ –¥–ª—è –¥–µ–º–æ)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑—É–µ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

**–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** (–≤ –¥–µ–º–æ –∫–∞–∫ –º–æ–∫–∏):
- **MockOrderRepository** - –ò–º–∏—Ç–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **MockPaymentService** - –ò–º–∏—Ç–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- **MockInventoryService** - –ò–º–∏—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —Å–∫–ª–∞–¥–∞
- **MockNotificationService** - –ò–º–∏—Ç–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–∞–π–ø–ª–∞–π–Ω

### –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è**: –°–æ–∑–¥–∞–µ—Ç—Å—è Pipeline Engine —Å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —à–∞–≥–∞–º–∏
2. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞**: –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ "–±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö"
3. **–ó–∞–ø—É—Å–∫ –ø–∞–π–ø–ª–∞–π–Ω–∞**: Engine –≤—ã–ø–æ–ª–Ω—è–µ—Ç —à–∞–≥–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
4. **–ö–∞–∂–¥—ã–π —à–∞–≥**:
   - –ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç —Å–≤–æ—é –ª–æ–≥–∏–∫—É  
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ —à–∞–≥–∞
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –î–µ—Ç–∞–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
Input: { "order_id": "xxx" }
    ‚Üì
Step 1: ValidateOrderStep
    ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∑–∞–∫–∞–∑ –≤ repository
    ‚Üí –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
    ‚Üí Output: { "is_valid": true, "order_status": "validated" }
    ‚Üì
Step 2: ProcessPaymentStep  
    ‚Üí –ü–æ–ª—É—á–∞–µ—Ç validated –∑–∞–∫–∞–∑
    ‚Üí –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–ª–∞—Ç–µ–∂ —á–µ—Ä–µ–∑ PaymentService
    ‚Üí Output: { "payment_id": "yyy", "payment_status": "succeeded" }
    ‚Üì
Step 3: CheckInventoryStep
    ‚Üí –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ —Ç–æ–≤–∞—Ä–æ–≤
    ‚Üí –†–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç —Ç–æ–≤–∞—Ä—ã –≤ InventoryService  
    ‚Üí Output: { "all_available": true, "reservation_id": "zzz" }
    ‚Üì
Step 4: SendNotificationsStep
    ‚Üí –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç email –∏ SMS
    ‚Üí Output: { "successful_notifications": ["email", "sms"] }
    ‚Üì
Result: Pipeline completed successfully
```

## üîß –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —à–∞–≥–∞ –≤ –ø–∞–π–ø–ª–∞–π–Ω

1. **–°–æ–∑–¥–∞–µ—Ç–µ –Ω–æ–≤—ã–π —à–∞–≥**:
```go
type ArrangeDeliveryStep struct {
    logger          *zap.Logger
    deliveryService DeliveryService
}

func (s *ArrangeDeliveryStep) Execute(ctx context.Context, data *pipeline.StepData) (*pipeline.StepResult, error) {
    // –õ–æ–≥–∏–∫–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç–∞–≤–∫–∏
}
```

2. **–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç–µ –≤ engine**:
```go
deliveryStep := NewArrangeDeliveryStep(logger, deliveryService)
engine.RegisterStep("arrange_delivery", deliveryStep)
```

3. **–î–æ–±–∞–≤–ª—è–µ—Ç–µ –≤ –ø–∞–π–ø–ª–∞–π–Ω**:
```go
pipelineDefinition := pipeline.PipelineDefinition{
    Steps: []string{
        "validate_order",
        "process_payment", 
        "check_inventory",
        "arrange_delivery", // ‚Üê –ù–æ–≤—ã–π —à–∞–≥
        "send_notifications",
    },
}
```

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö

–ß—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ —Å PostgreSQL –Ω–∞ MongoDB:

1. **Domain —Å–ª–æ–π** - –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚úÖ
2. **Use Case —Å–ª–æ–π** - –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚úÖ  
3. **Application —Å–ª–æ–π** - –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ‚úÖ
4. **Infrastructure —Å–ª–æ–π** - —Å–æ–∑–¥–∞–µ—Ç–µ –Ω–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é:

```go
type MongoOrderRepository struct {
    collection *mongo.Collection
}

func (r *MongoOrderRepository) Save(ctx context.Context, order *order.Order) error {
    // MongoDB —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
}
```

5. **DI Container** - –º–µ–Ω—è–µ—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é:
```go
// –ë—ã–ª–æ:
container.Register((*order.Repository)(nil), &PostgreSQLOrderRepository{})

// –°—Ç–∞–ª–æ: 
container.Register((*order.Repository)(nil), &MongoOrderRepository{})
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã (–¥–æ–º–µ–Ω–Ω—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏)

```bash
go test ./internal/domain/...
```

### Integration —Ç–µ—Å—Ç—ã (–ø–∞–π–ø–ª–∞–π–Ω —à–∞–≥–∏)

```bash
go test ./internal/application/...
```

### End-to-End —Ç–µ—Å—Ç—ã (–ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω)

```bash
go test ./cmd/pipeline/...
```

## üìö –ò–∑—É—á–µ–Ω–∏–µ –∫–æ–¥–∞

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –ø–æ—Ä—è–¥–æ–∫ –∏–∑—É—á–µ–Ω–∏—è:

1. **–ù–∞—á–Ω–∏—Ç–µ —Å –¥–æ–º–µ–Ω–Ω—ã—Ö —Å—É—â–Ω–æ—Å—Ç–µ–π**:
   - `internal/domain/order/entity.go` - –û—Å–Ω–æ–≤–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
   - `internal/domain/payment/entity.go` - –õ–æ–≥–∏–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
   - `internal/domain/product/entity.go` - –õ–æ–≥–∏–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤

2. **–ò–∑—É—á–∏—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**:
   - `internal/usecase/order_processing/interfaces.go` - –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã

3. **–ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –Ω–∞ Pipeline Engine**:
   - `pkg/pipeline/engine.go` - –Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã –ø–∞–π–ø–ª–∞–π–Ω–æ–≤

4. **–ò–∑—É—á–∏—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —à–∞–≥–∏**:
   - `internal/application/pipeline/order_steps.go` - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —à–∞–≥–æ–≤

5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–º–æ**:
   - `cmd/pipeline/main.go` - –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä –≤ –¥–µ–π—Å—Ç–≤–∏–∏

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è:

- **Dependency Injection** - –∫–∞–∫ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- **Interface Segregation** - –º–∞–ª–µ–Ω—å–∫–∏–µ, —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã  
- **Dependency Inversion** - –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–π, –Ω–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–π
- **Single Responsibility** - –∫–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∏–º–µ–µ—Ç –æ–¥–Ω—É –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
- **Pipeline Pattern** - —Ä–∞–∑–±–∏–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ —à–∞–≥–∏

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- **üìã –ü–æ–¥—Ä–æ–±–Ω–æ–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ**: `docs/ARCHITECTURE_GUIDE.md`
- **üîÑ –ü—Ä–∏–Ω—Ü–∏–ø—ã Pipeline Pattern**: –†–∞–∑–¥–µ–ª –≤ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–µ
- **üèõÔ∏è Clean Architecture**: –î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Å–ª–æ–µ–≤
- **üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã**: –†–µ–∞–ª—å–Ω—ã–µ –∫–µ–π—Å—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

## üöÄ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –≤ —Ä–µ–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–ª–∏—á–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:

- **E-commerce —Å–∏—Å—Ç–µ–º** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–∫–∞–∑–æ–≤, –ø–ª–∞—Ç–µ–∂–µ–π, —Å–∫–ª–∞–¥—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- **Workflow engines** - –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –±–∏–∑–Ω–µ—Å-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- **–°–∏—Å—Ç–µ–º—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç—Ç–∞–ø–æ–≤
- **–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã** - —Å complex business logic
- **–°–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏** - –∫–∞–∫ —Ç–≤–æ—è —Å–∏—Å—Ç–µ–º–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤! 

## ü§ù –°–≤—è–∑—å —Å —Ç–≤–æ–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º —Ç–µ–Ω–¥–µ—Ä–æ–≤

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –Ω–∞–ø—Ä—è–º—É—é –ø—Ä–∏–º–µ–Ω–∏–º–∞ –∫ —Ç–≤–æ–µ–π —Å–∏—Å—Ç–µ–º–µ:

- **Order** ‚Üî **Tender** (–∑–∞–∫–∞–∑ ‚Üî —Ç–µ–Ω–¥–µ—Ä)
- **Payment Processing** ‚Üî **Price Analysis** (–æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ ‚Üî –∞–Ω–∞–ª–∏–∑ —Ü–µ–Ω)
- **Inventory Check** ‚Üî **Document Processing** (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫–ª–∞–¥–∞ ‚Üî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤)
- **Notifications** ‚Üî **Email Campaign** (—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Üî email –∫–∞–º–ø–∞–Ω–∏—è)

–ú–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –∫–æ–¥ –∫–∞–∫ –æ—Å–Ω–æ–≤—É –¥–ª—è —Å–≤–æ–µ–π —Å–∏—Å—Ç–µ–º—ã —Ç–µ–Ω–¥–µ—Ä–æ–≤! üéØ