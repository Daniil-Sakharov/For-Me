# üï∑Ô∏è Pipeline: Tender Discovery
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞–π–ø–ª–∞–π–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞ —Ç–µ–Ω–¥–µ—Ä–æ–≤

name: "tender-discovery"
version: "1.0"
description: "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–µ–Ω–¥–µ—Ä–æ–≤ –Ω–∞ –∑–∞–∫—É–ø–æ—á–Ω—ã—Ö –ø–ª–æ—â–∞–¥–∫–∞—Ö"

# ‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞
schedule:
  interval: "1h"           # –ö–∞–∂–¥—ã–π —á–∞—Å
  timezone: "Europe/Moscow"
  enabled: true

# üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
config:
  # –ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞
  platforms:
    - name: "zakupki.gov.ru"
      url: "https://zakupki.gov.ru/epz/order/extendedsearch/results.html"
      enabled: true
      priority: 1
      rate_limit: "5s"     # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
      
    - name: "szvo.gov35.ru"  
      url: "https://szvo.gov35.ru/purchases"
      enabled: true
      priority: 2
      rate_limit: "3s"
      
    - name: "gz-spb.ru"
      url: "https://gz-spb.ru/search"
      enabled: true
      priority: 3
      rate_limit: "7s"

  # üîç –ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞
  search_criteria:
    keywords:
      required:           # –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        - "–º–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"
        - "–¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"
        - "–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"
        - "–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∏–∑–¥–µ–ª–∏—è"
        - "—Ä–µ–Ω—Ç–≥–µ–Ω"
        - "–£–ó–ò"
        - "—Ç–æ–º–æ–≥—Ä–∞—Ñ"
        - "–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä"
      
      optional:           # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ (–±–æ–Ω—É—Å –∫ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏)
        - "–±–æ–ª—å–Ω–∏—Ü–∞"
        - "–ø–æ–ª–∏–∫–ª–∏–Ω–∏–∫–∞"
        - "–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä"
        - "–ª–µ—á–µ–±–Ω–æ–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏–µ"
      
      excluded:           # –ò—Å–∫–ª—é—á–∞–µ–º—ã–µ —Å–ª–æ–≤–∞
        - "—É—Å–ª—É–≥–∏"
        - "—Ä–µ–º–æ–Ω—Ç"
        - "—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ"
        - "—Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ"
        - "–ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ"
    
    # üí∞ –¶–µ–Ω–æ–≤—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
    budget:
      min_amount: 100000      # –ú–∏–Ω–∏–º—É–º 100 —Ç—ã—Å. —Ä—É–±.
      max_amount: 50000000    # –ú–∞–∫—Å–∏–º—É–º 50 –º–ª–Ω. —Ä—É–±.
      currency: "RUB"
    
    # üìÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
    dates:
      start_date: "today"                    # –ù–∞—á–∏–Ω–∞—è —Å —Å–µ–≥–æ–¥–Ω—è
      end_date: "+30d"                       # –î–æ 30 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥
      min_deadline_days: 7                   # –ú–∏–Ω–∏–º—É–º 7 –¥–Ω–µ–π –¥–æ –ø–æ–¥–∞—á–∏ –∑–∞—è–≤–æ–∫
    
    # üè¢ –§–∏–ª—å—Ç—Ä—ã –∑–∞–∫–∞–∑—á–∏–∫–æ–≤
    customer_types:
      - "–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —É—á—Ä–µ–∂–¥–µ–Ω–∏—è"
      - "–≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–µ –±–æ–ª—å–Ω–∏—Ü—ã" 
      - "–æ–±–ª–∞—Å—Ç–Ω—ã–µ –±–æ–ª—å–Ω–∏—Ü—ã"
      - "–≥–æ—Ä–æ–¥—Å–∫–∏–µ –±–æ–ª—å–Ω–∏—Ü—ã"
      - "—Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã–µ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ü–µ–Ω—Ç—Ä—ã"

# üîÑ –≠—Ç–∞–ø—ã –ø–∞–π–ø–ª–∞–π–Ω–∞
stages:
  # –≠–¢–ê–ü 1: –ü–æ–∏—Å–∫ –∏ —Å–±–æ—Ä —Ç–µ–Ω–¥–µ—Ä–æ–≤
  - name: "scraping"
    type: "parallel"
    timeout: "30m"
    retry_count: 3
    
    steps:
      - name: "scrape_zakupki"
        type: "scraper"
        config:
          platform: "zakupki.gov.ru"
          max_pages: 10
          concurrent_requests: 3
          user_agent: "TenderBot/1.0 (Medical Equipment Scanner)"
          
      - name: "scrape_szvo"
        type: "scraper" 
        config:
          platform: "szvo.gov35.ru"
          max_pages: 5
          concurrent_requests: 2
          
      - name: "scrape_spb"
        type: "scraper"
        config:
          platform: "gz-spb.ru"
          max_pages: 3
          concurrent_requests: 2

  # –≠–¢–ê–ü 2: –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
  - name: "initial_filtering"
    type: "sequential"
    timeout: "10m"
    
    steps:
      - name: "deduplication"
        type: "filter"
        description: "–£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ –ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–Ω–¥–µ—Ä–∞"
        
      - name: "basic_validation"
        type: "validator"
        description: "–ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π"
        
      - name: "keyword_filtering"
        type: "filter"
        description: "–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º"

  # –≠–¢–ê–ü 3: AI –∞–Ω–∞–ª–∏–∑ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
  - name: "ai_analysis"
    type: "parallel"
    timeout: "45m"
    batch_size: 5        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –ø–æ 5 —Ç–µ–Ω–¥–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
    
    steps:
      - name: "relevance_analysis"
        type: "ai_processor"
        model: "llama4-maviric"
        config:
          prompt_template: "tender_relevance_analysis"
          confidence_threshold: 0.7
          max_tokens: 1000
          
      - name: "category_classification"
        type: "ai_processor"
        model: "llama4-maviric"
        config:
          prompt_template: "equipment_categorization"
          categories:
            - "–¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"
            - "–ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"
            - "—Ö–∏—Ä—É—Ä–≥–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"
            - "—Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ"
            - "–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ä–∞—Å—Ö–æ–¥–Ω–∏–∫–∏"

  # –≠–¢–ê–ü 4: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  - name: "persistence"
    type: "sequential"
    timeout: "5m"
    
    steps:
      - name: "save_to_database"
        type: "database"
        description: "–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–Ω–¥–µ—Ä–æ–≤ –≤ PostgreSQL"
        
      - name: "update_search_index"
        type: "search_index"
        description: "–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞"
        
      - name: "emit_events"
        type: "event_emitter"
        description: "–û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ –Ω–æ–≤—ã—Ö —Ç–µ–Ω–¥–µ—Ä–∞—Ö"

# üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
monitoring:
  metrics:
    - name: "tenders_discovered"
      type: "counter"
      description: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ç–µ–Ω–¥–µ—Ä–æ–≤"
      
    - name: "processing_time"
      type: "histogram"
      description: "–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–∞–π–ø–ª–∞–π–Ω–∞"
      
    - name: "ai_analysis_accuracy"
      type: "gauge"
      description: "–¢–æ—á–Ω–æ—Å—Ç—å AI –∞–Ω–∞–ª–∏–∑–∞"
      
    - name: "error_rate"
      type: "counter"
      description: "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫"

  alerts:
    - name: "no_tenders_found"
      condition: "tenders_discovered == 0"
      severity: "warning"
      notification: "slack"
      
    - name: "high_error_rate"
      condition: "error_rate > 10%"
      severity: "critical"
      notification: "email,slack"
      
    - name: "pipeline_timeout"
      condition: "processing_time > 60m"
      severity: "warning"
      notification: "slack"

# üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
recovery:
  auto_retry: true
  max_retries: 3
  retry_delay: "5m"
  
  # –î–µ–π—Å—Ç–≤–∏—è –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö
  on_failure:
    - action: "notify_admin"
      channels: ["email", "slack"]
    - action: "save_logs"
      retention: "7d"
    - action: "pause_pipeline"
      duration: "1h"

# üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
expected_results:
  tenders_per_run: 50-200      # –û–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ–Ω–¥–µ—Ä–æ–≤ –∑–∞ –∑–∞–ø—É—Å–∫
  relevant_percentage: 15-30   # –ü—Ä–æ—Ü–µ–Ω—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö —Ç–µ–Ω–¥–µ—Ä–æ–≤
  processing_time: 30-60       # –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –º–∏–Ω—É—Ç–∞—Ö
  ai_accuracy: 85-95           # –¢–æ—á–Ω–æ—Å—Ç—å AI –∞–Ω–∞–ª–∏–∑–∞ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö

# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
testing:
  enabled: true
  test_data: "test_tenders.json"
  
  acceptance_criteria:
    min_tenders_found: 10
    max_processing_time: "90m"
    min_ai_accuracy: 80
    max_error_rate: 5