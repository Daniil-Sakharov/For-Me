# üîç –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ Clean Architecture –Ω–∞ –ø—Ä–∏–º–µ—Ä–∞—Ö

–≠—Ç–æ—Ç —Ñ–∞–π–ª —Å–æ–¥–µ—Ä–∂–∏—Ç **–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–¥—Ä–æ–±–Ω–æ–µ** –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ —Ç–æ–≥–æ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å Clean Architecture. –ú—ã —Ä–∞–∑–±–µ—Ä–µ–º –∫–∞–∂–¥—ã–π —à–∞–≥, –∫–∞–∂–¥—É—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –∏ –∫–∞–∂–¥—ã–π –ø—Ä–∏–Ω—Ü–∏–ø –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–∞—Ö.

---

## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?](#-–∑–∞–ø—É—Å–∫-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è-—á—Ç–æ-–ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç)
- [üë§ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –ø–æ—à–∞–≥–æ–≤—ã–π —Ä–∞–∑–±–æ—Ä](#-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–ø–æ—à–∞–≥–æ–≤—ã–π-—Ä–∞–∑–±–æ—Ä)
- [üîê –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è](#-–≤—Ö–æ–¥-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–∫–∞–∫-—Ä–∞–±–æ—Ç–∞–µ—Ç-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)
- [üîó –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏: –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª](#-—Å–æ–∑–¥–∞–Ω–∏–µ-—Å—Å—ã–ª–∫–∏-–ø–æ–ª–Ω—ã–π-—Ü–∏–∫–ª)
- [üåê –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ: —Ä–µ–¥–∏—Ä–µ–∫—Ç](#-–ø–µ—Ä–µ—Ö–æ–¥-–ø–æ-–∫–æ—Ä–æ—Ç–∫–æ–π-—Å—Å—ã–ª–∫–µ-—Ä–µ–¥–∏—Ä–µ–∫—Ç)
- [üß© Dependency Injection: –∑–∞—á–µ–º –∏ –∫–∞–∫](#-dependency-injection-–∑–∞—á–µ–º-–∏-–∫–∞–∫)
- [üèóÔ∏è –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: —á—Ç–æ –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è](#Ô∏è-—Å–ª–æ–∏-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã-—á—Ç–æ-–≥–¥–µ-–Ω–∞—Ö–æ–¥–∏—Ç—Å—è)
- [üîÑ –ò–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ](#-–∏–Ω–≤–µ—Ä—Å–∏—è-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π-–ø–æ—á–µ–º—É-—ç—Ç–æ-–≤–∞–∂–Ω–æ)

---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç?

### –®–∞–≥ 1: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç `go run cmd/main.go`

–ö–æ–≥–¥–∞ –≤—ã –≤—ã–ø–æ–ª–Ω—è–µ—Ç–µ —ç—Ç—É –∫–æ–º–∞–Ω–¥—É, –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ `main()` –≤ —Ñ–∞–π–ª–µ `cmd/main.go`:

```go
func main() {
    fmt.Println("üöÄ Starting URL Shortener Service...")
    
    // –®–ê–ì 1: –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
    config, err := configs.LoadConfig()
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –ü—Ä–æ–≥—Ä–∞–º–º–∞ —á–∏—Ç–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ —Å–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É `Config` —Å–æ –≤—Å–µ–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏.

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```go
// –®–ê–ì 2: –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
container, err := di.NewContainer(config)
```

**–≠—Ç–æ —Å–∞–º–∞—è –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å!** –ó–¥–µ—Å—å —Å–æ–∑–¥–∞—é—Ç—Å—è **–í–°–ï** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –î–∞–≤–∞–π—Ç–µ —Ä–∞–∑–±–µ—Ä–µ–º –ø–æ–¥—Ä–æ–±–Ω–æ:

#### 2.1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```go
// –í pkg/di/container.go, –º–µ—Ç–æ–¥ initInfrastructure()
dbConfig := database.Config{
    Host:     "localhost",
    Port:     5432,
    User:     "postgres",
    Password: "postgres",
    DBName:   "url_shortener",
    SSLMode:  "disable",
}

db, err := database.NewConnection(dbConfig)
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è SQL –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü.

#### 2.2. –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

```go
// –í pkg/di/container.go, –º–µ—Ç–æ–¥ initRepositories()
c.UserRepo = database.NewUserRepository(c.DB)
c.LinkRepo = database.NewLinkRepository(c.DB)
```

**–í–∞–∂–Ω–æ:** –ú—ã —Å–æ–∑–¥–∞–µ–º **–∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, –Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ö –∫–∞–∫ **–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã**:

```go
type Container struct {
    UserRepo user.Repository  // ‚Üê –≠—Ç–æ –ò–ù–¢–ï–†–§–ï–ô–° –∏–∑ domain —Å–ª–æ—è!
    LinkRepo link.Repository  // ‚Üê –≠—Ç–æ —Ç–æ–∂–µ –ò–ù–¢–ï–†–§–ï–ô–°!
}
```

#### 2.3. –°–æ–∑–¥–∞–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

```go
// –í pkg/di/container.go, –º–µ—Ç–æ–¥ initExternalServices()
c.PasswordHasher = external.NewBcryptPasswordHasher(12)
c.TokenGenerator = external.NewJWTTokenGenerator("secret", "issuer", 24*time.Hour)
```

**–ó–∞—á–µ–º:** Use Cases –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã, –Ω–µ –∑–Ω–∞—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è—Ö.

#### 2.4. –°–æ–∑–¥–∞–Ω–∏–µ Use Cases

```go
// –í pkg/di/container.go, –º–µ—Ç–æ–¥ initUseCases()
c.RegisterUC = auth.NewRegisterUseCase(
    c.UserRepo,        // ‚Üê –ü–µ—Ä–µ–¥–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    c.PasswordHasher,  // ‚Üê –ü–µ—Ä–µ–¥–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ö–µ—à–µ—Ä–∞
    c.TokenGenerator,  // ‚Üê –ü–µ—Ä–µ–¥–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Ç–æ–∫–µ–Ω-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
)
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** Use Case –ø–æ–ª—É—á–∞–µ—Ç –í–°–ï —Å–≤–æ–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä. –û–Ω –Ω–µ —Å–æ–∑–¥–∞–µ—Ç –∏—Ö —Å–∞–º!

#### 2.5. –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤

```go
// –í pkg/di/container.go, –º–µ—Ç–æ–¥ initControllers()
c.AuthController = controllers.NewAuthController(
    c.RegisterUC,  // ‚Üê –ü–µ—Ä–µ–¥–∞–µ–º Use Case –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    c.LoginUC,     // ‚Üê –ü–µ—Ä–µ–¥–∞–µ–º Use Case –¥–ª—è –≤—Ö–æ–¥–∞
)
```

### –®–∞–≥ 3: –ó–∞–ø—É—Å–∫ HTTP —Å–µ—Ä–≤–µ—Ä–∞

```go
// –í main.go
go func() {
    if err := container.Server.Start(); err != nil {
        serverErrors <- err
    }
}()
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** HTTP —Å–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8080 –∏ –≥–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã.

---

## üë§ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –ø–æ—à–∞–≥–æ–≤—ã–π —Ä–∞–∑–±–æ—Ä

–¢–µ–ø–µ—Ä—å –¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Å–ª–µ–¥–∏–º **–≤–µ—Å—å –ø—É—Ç—å** –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é:

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å:

```bash
curl -X POST http://localhost:8080/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john@example.com",
    "password": "strongpassword123",
    "name": "John Doe"
  }'
```

### –®–ê–ì 1: HTTP Router –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä

–í `pkg/di/container.go` –º—ã –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏ –º–∞—Ä—à—Ä—É—Ç:

```go
mux.HandleFunc("POST /auth/register", web.ChainMiddleware(
    c.AuthController.Register,
    web.CORSMiddleware,
    web.LoggingMiddleware,
    web.RecoveryMiddleware,
))
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** HTTP –∑–∞–ø—Ä–æ—Å –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ middleware (CORS, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, recovery) –∏ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `AuthController.Register()`.

### –®–ê–ì 2: AuthController –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å

–§–∞–π–ª: `internal/interfaces/controllers/auth_controller.go`

```go
func (c *AuthController) Register(w http.ResponseWriter, r *http.Request) {
    // 2.1: –î–µ–∫–æ–¥–∏—Ä—É–µ–º JSON –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
    var req auth.RegisterRequest
    if err := json.NewDecoder(r.Body).Decode(&req); err != nil {
        c.writeErrorResponse(w, "Invalid JSON format", http.StatusBadRequest)
        return
    }
    
    // –¢–µ–ø–µ—Ä—å req —Å–æ–¥–µ—Ä–∂–∏—Ç:
    // req.Email = "john@example.com"
    // req.Password = "strongpassword123"  
    // req.Name = "John Doe"
    
    // 2.2: –í–∞–ª–∏–¥–∏—Ä—É–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    if err := c.validator.Struct(req); err != nil {
        c.writeErrorResponse(w, "Validation failed", http.StatusBadRequest)
        return
    }
    
    // 2.3: –í—ã–∑—ã–≤–∞–µ–º Use Case –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    response, err := c.registerUC.Execute(r.Context(), req)
```

**–í–∞–∂–Ω–æ:** –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏! –û–Ω —Ç–æ–ª—å–∫–æ:
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ HTTP –∑–∞–ø—Ä–æ—Å–∞
- –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç
- –í—ã–∑—ã–≤–∞–µ—Ç Use Case
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç HTTP –æ—Ç–≤–µ—Ç

### –®–ê–ì 3: RegisterUseCase –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

–§–∞–π–ª: `internal/usecase/auth/register.go`

```go
func (uc *RegisterUseCase) Execute(ctx context.Context, req RegisterRequest) (*RegisterResponse, error) {
    // 3.1: –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ç–∞–∫–∏–º email –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    exists, err := uc.userRepo.Exists(ctx, req.Email)
    if err != nil {
        return nil, err
    }
    if exists {
        return nil, ErrUserAlreadyExists  // –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ!
    }
```

**–í—ã–∑–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö:** `uc.userRepo.Exists()` - —ç—Ç–æ –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:

```go
type Repository interface {
    Exists(ctx context.Context, email string) (bool, error)
}
```

–†–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `internal/infrastructure/database/user_repository.go`:

```go
func (r *UserRepository) Exists(ctx context.Context, email string) (bool, error) {
    query := `SELECT EXISTS(SELECT 1 FROM users WHERE email = $1)`
    
    var exists bool
    err := r.db.QueryRowContext(ctx, query, email).Scan(&exists)
    return exists, err
}
```

**SQL –∑–∞–ø—Ä–æ—Å:** `SELECT EXISTS(SELECT 1 FROM users WHERE email = 'john@example.com')`

–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º Use Case:

```go
    // 3.2: –í–∞–ª–∏–¥–∏—Ä—É–µ–º —Å–∏–ª—É –ø–∞—Ä–æ–ª—è (–±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ)
    if len(req.Password) < 8 {
        return nil, ErrWeakPassword
    }
    
    // 3.3: –°–æ–∑–¥–∞–µ–º –¥–æ–º–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    newUser, err := user.NewUser(req.Email, req.Name)
    if err != nil {
        return nil, err
    }
```

### –®–ê–ì 4: –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏

–§–∞–π–ª: `internal/domain/user/entity.go`

```go
func NewUser(email, name string) (*User, error) {
    // –í–∞–ª–∏–¥–∞—Ü–∏—è email —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–º–µ–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º
    if !isValidEmail(email) {
        return nil, ErrInvalidEmail
    }
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏
    if name == "" {
        return nil, ErrEmptyName
    }
    
    now := time.Now()
    
    return &User{
        Email:     email,      // "john@example.com"
        Name:      name,       // "John Doe"
        CreatedAt: now,
        UpdatedAt: now,
    }, nil
}
```

**–í–∞–∂–Ω–æ:** –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ë–ò–ó–ù–ï–°-–ü–†–ê–í–ò–õ–ê (–≤–∞–ª–∏–¥–Ω—ã–π email, –Ω–µ–ø—É—Å—Ç–æ–µ –∏–º—è).

–í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ Use Case:

```go
    // 3.4: –•–µ—à–∏—Ä—É–µ–º –ø–∞—Ä–æ–ª—å —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å
    hashedPassword, err := uc.passwordHasher.Hash(req.Password)
    if err != nil {
        return nil, err
    }
```

### –®–ê–ì 5: –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª—è

`uc.passwordHasher` - —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:

```go
type PasswordHasher interface {
    Hash(password string) (string, error)
}
```

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `internal/infrastructure/external/password_hasher.go`:

```go
func (h *BcryptPasswordHasher) Hash(password string) (string, error) {
    hashedBytes, err := bcrypt.GenerateFromPassword([]byte(password), h.cost)
    return string(hashedBytes), nil
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** `"strongpassword123"` –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ `"$2a$12$..."` (bcrypt hash).

–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º Use Case:

```go
    // 3.5: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞—Ö–µ—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
    err = newUser.SetPassword(hashedPassword)
    if err != nil {
        return nil, err
    }
    
    // 3.6: –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    err = uc.userRepo.Save(ctx, newUser)
    if err != nil {
        return nil, err
    }
```

### –®–ê–ì 6: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

`uc.userRepo.Save()` –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ `internal/infrastructure/database/user_repository.go`:

```go
func (r *UserRepository) Save(ctx context.Context, u *user.User) error {
    if u.ID == 0 {
        return r.create(ctx, u)  // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    }
    return r.update(ctx, u)      // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ
}

func (r *UserRepository) create(ctx context.Context, u *user.User) error {
    query := `
        INSERT INTO users (email, hashed_password, name, created_at, updated_at)
        VALUES ($1, $2, $3, $4, $5)
        RETURNING id`

    err := r.db.QueryRowContext(
        ctx,
        query,
        u.Email,         // "john@example.com"
        u.HashedPassword, // "$2a$12$..."
        u.Name,          // "John Doe"
        u.CreatedAt,
        u.UpdatedAt,
    ).Scan(&u.ID)
    
    return err
}
```

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
INSERT INTO users (email, hashed_password, name, created_at, updated_at)
VALUES ('john@example.com', '$2a$12$...', 'John Doe', '2024-01-01 12:00:00', '2024-01-01 12:00:00')
RETURNING id
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ –ë–î, –ø–æ–ª—É—á–µ–Ω ID (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1).

–§–∏–Ω–∞–ª Use Case:

```go
    // 3.7: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º JWT —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—Ö–æ–¥–∞
    token, err := uc.tokenGenerator.Generate(newUser.ID, newUser.Email)
    if err != nil {
        return nil, err
    }
    
    // 3.8: –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç
    return &RegisterResponse{
        Token:  token,
        UserID: newUser.ID,
        Email:  newUser.Email,
        Name:   newUser.Name,
    }, nil
}
```

### –®–ê–ì 7: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞

`uc.tokenGenerator.Generate()` –≤—ã–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –≤ `internal/infrastructure/external/jwt_generator.go`:

```go
func (g *JWTTokenGenerator) Generate(userID uint, email string) (string, error) {
    claims := Claims{
        UserID: userID,    // 1
        Email:  email,     // "john@example.com"
        RegisteredClaims: jwt.RegisteredClaims{
            Issuer:    g.issuer,
            ExpiresAt: jwt.NewNumericDate(time.Now().Add(g.expiry)),
        },
    }
    
    token := jwt.NewWithClaims(jwt.SigningMethodHS256, claims)
    return token.SignedString(g.secretKey)
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** JWT —Ç–æ–∫–µ–Ω —Ç–∏–ø–∞ `"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."`

### –®–ê–ì 8: –í–æ–∑–≤—Ä–∞—Ç HTTP –æ—Ç–≤–µ—Ç–∞

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –æ—Ç Use Case –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç HTTP –æ—Ç–≤–µ—Ç:

```go
// –í AuthController.Register()
response, err := c.registerUC.Execute(r.Context(), req)
if err != nil {
    c.writeErrorResponse(w, err.Error(), http.StatusBadRequest)
    return
}

c.writeJSONResponse(w, response, http.StatusCreated)
```

**HTTP –æ—Ç–≤–µ—Ç:**
```json
HTTP/1.1 201 Created
Content-Type: application/json

{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user_id": 1,
  "email": "john@example.com",
  "name": "John Doe"
}
```

---

## üîê –í—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É:

```bash
curl -X POST http://localhost:8080/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "john@example.com",
    "password": "strongpassword123"
  }'
```

### –®–ê–ì 1-2: HTTP Router ‚Üí AuthController.Login()

–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –∑–∞–ø—Ä–æ—Å –ø–æ–ø–∞–¥–∞–µ—Ç –≤ `AuthController.Login()`.

### –®–ê–ì 3: LoginUseCase –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é

–§–∞–π–ª: `internal/usecase/auth/login.go`

```go
func (uc *LoginUseCase) Execute(ctx context.Context, req LoginRequest) (*LoginResponse, error) {
    // 3.1: –ù–∞—Ö–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ email
    existingUser, err := uc.userRepo.FindByEmail(ctx, req.Email)
    if err != nil {
        return nil, err
    }
    if existingUser == nil {
        return nil, ErrUserNotFound
    }
```

**SQL –∑–∞–ø—Ä–æ—Å –≤ UserRepository:**
```sql
SELECT id, email, hashed_password, name, created_at, updated_at
FROM users
WHERE email = 'john@example.com'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–∞–π–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID=1, –∏–º–µ–Ω–µ–º "John Doe" –∏ —Ö–µ—à–µ–º –ø–∞—Ä–æ–ª—è.

```go
    // 3.2: –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–æ–ª—å
    err = uc.passwordHasher.Compare(existingUser.HashedPassword, req.Password)
    if err != nil {
        return nil, ErrInvalidCredentials
    }
```

### –®–ê–ì 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è

`uc.passwordHasher.Compare()` –≤ `internal/infrastructure/external/password_hasher.go`:

```go
func (h *BcryptPasswordHasher) Compare(hashedPassword, password string) error {
    return bcrypt.CompareHashAndPassword([]byte(hashedPassword), []byte(password))
}
```

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:** 
- `hashedPassword` = `"$2a$12$..."` (–∏–∑ –ë–î)
- `password` = `"strongpassword123"` (–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
- bcrypt –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å–ª–∏ –ø–∞—Ä–æ–ª–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç, –æ—à–∏–±–∫–∏ –Ω–µ—Ç. –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç - –æ—à–∏–±–∫–∞.

```go
    // 3.3: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º JWT —Ç–æ–∫–µ–Ω
    token, err := uc.tokenGenerator.Generate(existingUser.ID, existingUser.Email)
    
    return &LoginResponse{
        Token:  token,
        UserID: existingUser.ID,
        Email:  existingUser.Email,
        Name:   existingUser.Name,
    }, nil
}
```

**HTTP –æ—Ç–≤–µ—Ç:** –ê–Ω–∞–ª–æ–≥–∏—á–µ–Ω —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏, –Ω–æ —Å—Ç–∞—Ç—É—Å 200 OK.

---

## üîó –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏: –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª

–¢–µ–ø–µ—Ä—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç —Å–æ–∑–¥–∞—Ç—å –∫–æ—Ä–æ—Ç–∫—É—é —Å—Å—ã–ª–∫—É:

```bash
curl -X POST http://localhost:8080/links \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." \
  -H "Content-Type: application/json" \
  -d '{
    "original_url": "https://very-long-url.com/some/very/long/path",
    "custom_code": "my-link"
  }'
```

### –®–ê–ì 1: HTTP Router ‚Üí Middleware ‚Üí LinkController

```go
// –í pkg/di/container.go
mux.HandleFunc("POST /links", web.ChainMiddleware(
    c.LinkController.CreateLink,
    c.authMiddleware.RequireAuth, // ‚Üê –í–ê–ñ–ù–û: –°–Ω–∞—á–∞–ª–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è!
    web.CORSMiddleware,
    web.LoggingMiddleware,
    web.RecoveryMiddleware,
))
```

### –®–ê–ì 2: AuthMiddleware –ø—Ä–æ–≤–µ—Ä—è–µ—Ç JWT —Ç–æ–∫–µ–Ω

–§–∞–π–ª: `internal/infrastructure/web/middleware.go`

```go
func (m *AuthMiddleware) RequireAuth(next http.HandlerFunc) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        // 2.1: –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Authorization
        authHeader := r.Header.Get("Authorization")
        // authHeader = "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        
        // 2.2: –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç "Bearer <token>"
        parts := strings.SplitN(authHeader, " ", 2)
        token := parts[1] // "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        
        // 2.3: –í–∞–ª–∏–¥–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω
        tokenData, err := m.tokenGenerator.Validate(token)
        if err != nil {
            http.Error(w, "Invalid token", http.StatusUnauthorized)
            return
        }
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è JWT —Ç–æ–∫–µ–Ω–∞** –≤ `internal/infrastructure/external/jwt_generator.go`:

```go
func (g *JWTTokenGenerator) Validate(tokenString string) (*auth.TokenData, error) {
    // –ü–∞—Ä—Å–∏–º –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å—å —Ç–æ–∫–µ–Ω–∞
    token, err := jwt.ParseWithClaims(tokenString, &Claims{}, func(token *jwt.Token) (interface{}, error) {
        return g.secretKey, nil
    })
    
    claims, ok := token.Claims.(*Claims)
    
    return &auth.TokenData{
        UserID: claims.UserID,  // 1
        Email:  claims.Email,   // "john@example.com"
    }, nil
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–µ–Ω, –ø–æ–ª—É—á–µ–Ω—ã UserID=1 –∏ Email="john@example.com".

```go
        // 2.4: –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
        ctx := context.WithValue(r.Context(), UserIDKey, tokenData.UserID)
        ctx = context.WithValue(ctx, UserEmailKey, tokenData.Email)
        r = r.WithContext(ctx)
        
        // 2.5: –ü–µ—Ä–µ–¥–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–º—É handler
        next(w, r)
    }
}
```

**–í–∞–∂–Ω–æ:** –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –∑–∞–ø—Ä–æ—Å–∞ –∏ –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–µ!

### –®–ê–ì 3: LinkController.CreateLink()

–§–∞–π–ª: `internal/interfaces/controllers/link_controller.go`

```go
func (c *LinkController) CreateLink(w http.ResponseWriter, r *http.Request) {
    // 3.1: –ò–∑–≤–ª–µ–∫–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    userID, ok := web.GetUserIDFromContext(r.Context())
    if !ok {
        c.writeErrorResponse(w, "User not authenticated", http.StatusUnauthorized)
        return
    }
    // userID = 1 (–∏–∑ JWT —Ç–æ–∫–µ–Ω–∞)
    
    // 3.2: –î–µ–∫–æ–¥–∏—Ä—É–µ–º JSON –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
    var req link.CreateLinkRequest
    json.NewDecoder(r.Body).Decode(&req)
    // req.OriginalURL = "https://very-long-url.com/some/very/long/path"
    // req.CustomCode = "my-link"
    
    // 3.3: –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –∑–∞–ø—Ä–æ—Å
    req.UserID = userID  // 1
    
    // 3.4: –í—ã–∑—ã–≤–∞–µ–º Use Case
    response, err := c.createLinkUC.Execute(r.Context(), req)
```

### –®–ê–ì 4: CreateLinkUseCase –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

–§–∞–π–ª: `internal/usecase/link/create.go`

```go
func (uc *CreateLinkUseCase) Execute(ctx context.Context, req CreateLinkRequest) (*CreateLinkResponse, error) {
    // 4.1: –í–∞–ª–∏–¥–∏—Ä—É–µ–º URL –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å
    err := uc.urlValidator.Validate(req.OriginalURL)
    if err != nil {
        return nil, err
    }
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è URL** –≤ `pkg/di/container.go` (SimpleURLValidator):

```go
func (v *SimpleURLValidator) Validate(rawURL string) error {
    _, err := url.Parse(rawURL)  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ URL –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π
    return err
}
```

```go
    // 4.2: –ü—Ä–æ–≤–µ—Ä—è–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å URL
    isSafe, err := uc.urlValidator.IsSafe(req.OriginalURL)
    if !isSafe {
        return nil, ErrUnsafeURL
    }
    
    // 4.3: –°–æ–∑–¥–∞–µ–º —Å—Å—ã–ª–∫—É —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∫–æ–¥–æ–º
    if req.CustomCode != "" {
        newLink, err = uc.createLinkWithCustomCode(ctx, req)
    }
```

### –®–ê–ì 5: –°–æ–∑–¥–∞–Ω–∏–µ —Å—Å—ã–ª–∫–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º –∫–æ–¥–æ–º

```go
func (uc *CreateLinkUseCase) createLinkWithCustomCode(ctx context.Context, req CreateLinkRequest) (*link.Link, error) {
    // 5.1: –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ–¥–∞
    exists, err := uc.linkRepo.ExistsByShortCode(ctx, req.CustomCode)
    if exists {
        return nil, ErrShortCodeAlreadyExists
    }
```

**SQL –∑–∞–ø—Ä–æ—Å –≤ LinkRepository:**
```sql
SELECT EXISTS(SELECT 1 FROM links WHERE short_code = 'my-link')
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, –∫–æ–¥ "my-link" –µ—â–µ –Ω–µ –∑–∞–Ω—è—Ç.

```go
    // 5.2: –°–æ–∑–¥–∞–µ–º –¥–æ–º–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å —Å—Å—ã–ª–∫–∏
    return link.NewLinkWithCustomCode(req.OriginalURL, req.CustomCode, req.UserID)
}
```

### –®–ê–ì 6: –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ Link

–§–∞–π–ª: `internal/domain/link/entity.go`

```go
func NewLinkWithCustomCode(originalURL, shortCode string, userID uint) (*Link, error) {
    // 6.1: –í–∞–ª–∏–¥–∞—Ü–∏—è URL —Å–æ–≥–ª–∞—Å–Ω–æ –¥–æ–º–µ–Ω–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º
    if err := validateURL(originalURL); err != nil {
        return nil, err
    }
    
    // 6.2: –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –∫–æ–¥–∞
    if err := validateShortCode(shortCode); err != nil {
        return nil, err
    }
    
    now := time.Now()
    
    return &Link{
        OriginalURL: originalURL,  // "https://very-long-url.com/some/very/long/path"
        ShortCode:   shortCode,    // "my-link"
        UserID:      userID,       // 1
        CreatedAt:   now,
        UpdatedAt:   now,
        ClicksCount: 0,
    }, nil
}
```

**–î–æ–º–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
- URL –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å—Ö–µ–º—É (http/https) –∏ —Ö–æ—Å—Ç
- –ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã, –¥–ª–∏–Ω–∞ 3-10 —Å–∏–º–≤–æ–ª–æ–≤

–í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ Use Case:

```go
    // 4.4: –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    err = uc.linkRepo.Save(ctx, newLink)
    if err != nil {
        return nil, err
    }
```

### –®–ê–ì 7: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –≤ –ë–î

`uc.linkRepo.Save()` –≤ `internal/infrastructure/database/link_repository.go`:

```go
func (r *LinkRepository) Save(ctx context.Context, l *link.Link) error {
    if l.ID == 0 {
        return r.create(ctx, l)
    }
    return r.update(ctx, l)
}

func (r *LinkRepository) create(ctx context.Context, l *link.Link) error {
    query := `
        INSERT INTO links (original_url, short_code, user_id, clicks_count, created_at, updated_at)
        VALUES ($1, $2, $3, $4, $5, $6)
        RETURNING id`

    err := r.db.QueryRowContext(
        ctx,
        query,
        l.OriginalURL,  // "https://very-long-url.com/some/very/long/path"
        l.ShortCode,    // "my-link"
        l.UserID,       // 1
        l.ClicksCount,  // 0
        l.CreatedAt,
        l.UpdatedAt,
    ).Scan(&l.ID)
    
    return err
}
```

**SQL –∑–∞–ø—Ä–æ—Å:**
```sql
INSERT INTO links (original_url, short_code, user_id, clicks_count, created_at, updated_at)
VALUES ('https://very-long-url.com/some/very/long/path', 'my-link', 1, 0, '2024-01-01 12:00:00', '2024-01-01 12:00:00')
RETURNING id
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Å—ã–ª–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ —Å ID=1.

–§–∏–Ω–∞–ª Use Case:

```go
    // 4.5: –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
    return &CreateLinkResponse{
        ID:          newLink.ID,          // 1
        OriginalURL: newLink.OriginalURL, // "https://very-long-url.com/some/very/long/path"
        ShortCode:   newLink.ShortCode,   // "my-link"
        ShortURL:    uc.baseURL + "/" + newLink.ShortCode,  // "http://localhost:8080/my-link"
        CreatedAt:   newLink.CreatedAt.Format("2006-01-02T15:04:05Z"),
    }, nil
}
```

**HTTP –æ—Ç–≤–µ—Ç:**
```json
HTTP/1.1 201 Created
Content-Type: application/json

{
  "id": 1,
  "original_url": "https://very-long-url.com/some/very/long/path",
  "short_code": "my-link",
  "short_url": "http://localhost:8080/my-link",
  "created_at": "2024-01-01T12:00:00Z"
}
```

---

## üåê –ü–µ—Ä–µ—Ö–æ–¥ –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ: —Ä–µ–¥–∏—Ä–µ–∫—Ç

–¢–µ–ø–µ—Ä—å –ª—é–±–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (–¥–∞–∂–µ –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π) –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ:

```bash
curl -L http://localhost:8080/my-link
```

### –®–ê–ì 1: HTTP Router ‚Üí LinkController.Redirect()

```go
// –í pkg/di/container.go
mux.HandleFunc("GET /", web.ChainMiddleware(
    c.LinkController.Redirect,
    // –ù–ï–¢ authMiddleware! –†–µ–¥–∏—Ä–µ–∫—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤—Å–µ–º
    web.CORSMiddleware,
    web.LoggingMiddleware,
    web.RecoveryMiddleware,
))
```

**–í–∞–∂–Ω–æ:** –ú–∞—Ä—à—Ä—É—Ç `GET /` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ª—é–±–æ–π –ø—É—Ç—å, –≤–∫–ª—é—á–∞—è `/my-link`.

### –®–ê–ì 2: LinkController.Redirect()

–§–∞–π–ª: `internal/interfaces/controllers/link_controller.go`

```go
func (c *LinkController) Redirect(w http.ResponseWriter, r *http.Request) {
    // 2.1: –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–¥ –∏–∑ URL –ø—É—Ç–∏
    path := strings.TrimPrefix(r.URL.Path, "/")
    // r.URL.Path = "/my-link"
    // path = "my-link"
    
    if path == "" {
        c.writeErrorResponse(w, "Short code is required", http.StatusBadRequest)
        return
    }
    
    // 2.2: –°–æ–∑–¥–∞–µ–º –∑–∞–ø—Ä–æ—Å –¥–ª—è Use Case
    req := link.RedirectRequest{
        ShortCode: path,                           // "my-link"
        UserAgent: r.Header.Get("User-Agent"),     // "Mozilla/5.0..."
        IPAddress: c.getClientIP(r),               // "192.168.1.100"
        Referer:   r.Header.Get("Referer"),        // "https://google.com"
    }
    
    // 2.3: –í—ã–∑—ã–≤–∞–µ–º Use Case
    response, err := c.redirectUC.Execute(r.Context(), req)
```

### –®–ê–ì 3: RedirectUseCase –Ω–∞—Ö–æ–¥–∏—Ç —Å—Å—ã–ª–∫—É

–§–∞–π–ª: `internal/usecase/link/redirect.go`

```go
func (uc *RedirectUseCase) Execute(ctx context.Context, req RedirectRequest) (*RedirectResponse, error) {
    // 3.1: –ù–∞—Ö–æ–¥–∏–º —Å—Å—ã–ª–∫—É –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–º—É –∫–æ–¥—É
    foundLink, err := uc.linkRepo.FindByShortCode(ctx, req.ShortCode)
    if foundLink == nil {
        return nil, ErrLinkNotFound
    }
```

**SQL –∑–∞–ø—Ä–æ—Å –≤ LinkRepository:**
```sql
SELECT id, original_url, short_code, user_id, clicks_count, created_at, updated_at
FROM links
WHERE short_code = 'my-link'
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ù–∞–π–¥–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ —Å ID=1, OriginalURL="https://very-long-url.com/some/very/long/path".

```go
    // 3.2: –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–ª–∏–∫–æ–≤ –≤ –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏
    foundLink.IncrementClicks()
```

### –®–ê–ì 4: –î–æ–º–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞

–§–∞–π–ª: `internal/domain/link/entity.go`

```go
func (l *Link) IncrementClicks() {
    l.ClicksCount++           // –ë—ã–ª–æ 0, —Å—Ç–∞–ª–æ 1
    l.UpdatedAt = time.Now()  // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è
}
```

**–í–∞–∂–Ω–æ:** –≠—Ç–æ –¥–æ–º–µ–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è! –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–æ: –∫–∞–∂–¥—ã–π –ø–µ—Ä–µ—Ö–æ–¥ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç—á–∏–∫.

–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º Use Case:

```go
    // 3.3: –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
    err = uc.linkRepo.IncrementClicks(ctx, foundLink.ID)
    if err != nil {
        // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫—É, –Ω–æ –ù–ï –ø—Ä–µ—Ä—ã–≤–∞–µ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç
        // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω –¥–∞–∂–µ –µ—Å–ª–∏ —Å—á–µ—Ç—á–∏–∫ –Ω–µ –æ–±–Ω–æ–≤–∏–ª—Å—è
    }
```

**SQL –∑–∞–ø—Ä–æ—Å –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—á–µ—Ç—á–∏–∫–∞:**
```sql
UPDATE links SET clicks_count = clicks_count + 1, updated_at = NOW() WHERE id = 1
```

```go
    // 3.4: –ü—É–±–ª–∏–∫—É–µ–º —Å–æ–±—ã—Ç–∏–µ –æ –∫–ª–∏–∫–µ –¥–ª—è —Å–±–æ—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
    err = uc.eventPublisher.PublishLinkClicked(
        foundLink.ID,    // 1
        req.UserAgent,   // "Mozilla/5.0..."
        req.IPAddress,   // "192.168.1.100"
        req.Referer,     // "https://google.com"
    )
    // –í –Ω–∞—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —ç—Ç–æ –∑–∞–≥–ª—É—à–∫–∞, –Ω–æ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–æ–µ–∫—Ç–µ
    // –∑–¥–µ—Å—å –±—ã–ª–∞ –±—ã –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
    
    // 3.5: –í–æ–∑–≤—Ä–∞—â–∞–µ–º URL –¥–ª—è —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
    return &RedirectResponse{
        OriginalURL: foundLink.OriginalURL,  // "https://very-long-url.com/some/very/long/path"
        LinkID:      foundLink.ID,           // 1
    }, nil
}
```

### –®–ê–ì 5: HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç

–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –ø–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç:

```go
// –í LinkController.Redirect()
response, err := c.redirectUC.Execute(r.Context(), req)
if err != nil {
    c.writeErrorResponse(w, err.Error(), http.StatusNotFound)
    return
}

// –í—ã–ø–æ–ª–Ω—è–µ–º HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç
http.Redirect(w, r, response.OriginalURL, http.StatusFound)
```

**HTTP –æ—Ç–≤–µ—Ç:**
```
HTTP/1.1 302 Found
Location: https://very-long-url.com/some/very/long/path
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë—Ä–∞—É–∑–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π URL!

---

## üß© Dependency Injection: –∑–∞—á–µ–º –∏ –∫–∞–∫

### –ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ DI

–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, –µ—Å–ª–∏ –±—ã –Ω–∞—à `RegisterUseCase` —Å–æ–∑–¥–∞–≤–∞–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–∞–º:

```go
// ‚ùå –ü–õ–û–•–û–ô –ü–†–ò–ú–ï–† (–±–µ–∑ DI)
func (uc *RegisterUseCase) Execute(req RegisterRequest) {
    // –°–æ–∑–¥–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä—è–º–æ –≤ Use Case
    db, _ := sql.Open("postgres", "host=localhost...")
    userRepo := &PostgreSQLUserRepository{db: db}
    
    hasher := &BcryptPasswordHasher{cost: 12}
    tokenGen := &JWTTokenGenerator{secret: "secret"}
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏...
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. **–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** - –Ω–µ–ª—å–∑—è –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –º–æ–∫–∏
2. **–ñ–µ—Å—Ç–∫–∞—è —Å–≤—è–∑–∞–Ω–Ω–æ—Å—Ç—å** - Use Case –∑–Ω–∞–µ—Ç –æ PostgreSQL, bcrypt, JWT
3. **–ù–∞—Ä—É—à–µ–Ω–∏–µ Single Responsibility** - Use Case –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
4. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** - –∫–∞–∂–¥—ã–π Use Case —Å–æ–∑–¥–∞–µ—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –æ–±—ä–µ–∫—Ç—ã

### –†–µ—à–µ–Ω–∏–µ —Å DI

```go
// ‚úÖ –•–û–†–û–®–ò–ô –ü–†–ò–ú–ï–† (—Å DI)
type RegisterUseCase struct {
    userRepo       user.Repository    // ‚Üê –ò–ù–¢–ï–†–§–ï–ô–°!
    passwordHasher PasswordHasher     // ‚Üê –ò–ù–¢–ï–†–§–ï–ô–°!
    tokenGenerator TokenGenerator     // ‚Üê –ò–ù–¢–ï–†–§–ï–ô–°!
}

func NewRegisterUseCase(
    userRepo user.Repository,
    passwordHasher PasswordHasher,
    tokenGenerator TokenGenerator,
) *RegisterUseCase {
    return &RegisterUseCase{
        userRepo:       userRepo,
        passwordHasher: passwordHasher,
        tokenGenerator: tokenGenerator,
    }
}
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
1. **–õ–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
```go
func TestRegisterUseCase(t *testing.T) {
    mockRepo := &MockUserRepository{}
    mockHasher := &MockPasswordHasher{}
    mockTokenGen := &MockTokenGenerator{}
    
    useCase := NewRegisterUseCase(mockRepo, mockHasher, mockTokenGen)
    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î!
}
```

2. **–õ–µ–≥–∫–æ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```go
// –ú–æ–∂–µ–º –∑–∞–º–µ–Ω–∏—Ç—å PostgreSQL –Ω–∞ MongoDB
userRepo := &MongoUserRepository{client: mongoClient}

// –ú–æ–∂–µ–º –∑–∞–º–µ–Ω–∏—Ç—å bcrypt –Ω–∞ argon2
passwordHasher := &Argon2PasswordHasher{}

// –ú–æ–∂–µ–º –¥–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
userRepo = &CachedUserRepository{
    inner: userRepo,
    cache: redisClient,
}
```

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞—à DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

–í `pkg/di/container.go`:

```go
func NewContainer(config *configs.Config) (*Container, error) {
    container := &Container{Config: config}
    
    // 1. –°–æ–∑–¥–∞–µ–º –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É (–ë–î, —Å–µ—Ä–≤–µ—Ä)
    container.initInfrastructure()
    
    // 2. –°–æ–∑–¥–∞–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–∏—Å–ø–æ–ª—å–∑—É—é—Ç –ë–î)
    container.initRepositories()
    
    // 3. –°–æ–∑–¥–∞–µ–º –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã (bcrypt, JWT)
    container.initExternalServices()
    
    // 4. –°–æ–∑–¥–∞–µ–º Use Cases (–∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –∏ —Å–µ—Ä–≤–∏—Å—ã)
    container.initUseCases()
    
    // 5. –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç Use Cases)
    container.initControllers()
    
    return container, nil
}
```

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ö–∞–∂–¥—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç —Å–≤–æ–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≥–æ—Ç–æ–≤—ã–º–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä.

**–ì—Ä–∞—Ñ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:**
```
AuthController
     ‚Üì (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç)
RegisterUseCase
     ‚Üì (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç)
UserRepository, PasswordHasher, TokenGenerator
     ‚Üì (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç)
Database, Config
```

**–ü–æ—Ä—è–¥–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è:** —Å–Ω–∏–∑—É –≤–≤–µ—Ä—Ö!
1. Database
2. UserRepository (–Ω—É–∂–Ω–∞ Database)
3. PasswordHasher, TokenGenerator
4. RegisterUseCase (–Ω—É–∂–Ω—ã Repository, PasswordHasher, TokenGenerator)
5. AuthController (–Ω—É–∂–µ–Ω RegisterUseCase)

---

## üèóÔ∏è –°–ª–æ–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã: —á—Ç–æ –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è

### üèõÔ∏è Domain Layer (–°–∞–º—ã–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `internal/domain/`

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- **Entities** (–¥–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏)
- **Repository interfaces** (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–ª—è –¥–∞–Ω–Ω—ã—Ö)
- **Domain errors** (–±–∏–∑–Ω–µ—Å-–æ—à–∏–±–∫–∏)

**–ü—Ä–∏–º–µ—Ä - User Entity:**
```go
// internal/domain/user/entity.go
type User struct {
    ID             uint
    Email          string
    HashedPassword string
    Name           string
    CreatedAt      time.Time
    UpdatedAt      time.Time
}

func NewUser(email, name string) (*User, error) {
    if !isValidEmail(email) {
        return nil, ErrInvalidEmail  // –î–æ–º–µ–Ω–Ω–∞—è –æ—à–∏–±–∫–∞
    }
    // –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
}
```

**–ü—Ä–∞–≤–∏–ª–∞ Domain —Å–ª–æ—è:**
- ‚úÖ –ù–ï–¢ –∏–º–ø–æ—Ä—Ç–æ–≤ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ (–∫—Ä–æ–º–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Go)
- ‚úÖ –ù–ï –ó–ù–ê–ï–¢ –æ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö, HTTP, JSON
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —á–∏—Å—Ç—ã–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
- ‚úÖ –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ entities –∏–∑ —Ç–æ–≥–æ –∂–µ —Å–ª–æ—è

### üíº Use Cases Layer (Application Business Rules)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `internal/usecase/`

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- **Use Cases** (—Å—Ü–µ–Ω–∞—Ä–∏–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)
- **Request/Response structures** (–≤—Ö–æ–¥–Ω—ã–µ –∏ –≤—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- **Interfaces –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (–∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤)

**–ü—Ä–∏–º–µ—Ä - RegisterUseCase:**
```go
// internal/usecase/auth/register.go
func (uc *RegisterUseCase) Execute(ctx context.Context, req RegisterRequest) (*RegisterResponse, error) {
    // –û–†–ö–ï–°–¢–†–ê–¶–ò–Ø: –∫–æ–æ—Ä–¥–∏–Ω–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
    
    // 1. –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    exists, _ := uc.userRepo.Exists(ctx, req.Email)
    
    // 2. –°–æ–∑–¥–∞–µ–º –¥–æ–º–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å
    newUser, _ := user.NewUser(req.Email, req.Name)
    
    // 3. –ò—Å–ø–æ–ª—å–∑—É–µ–º –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å
    hashedPassword, _ := uc.passwordHasher.Hash(req.Password)
    
    // 4. –°–æ—Ö—Ä–∞–Ω—è–µ–º —á–µ—Ä–µ–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    _ = uc.userRepo.Save(ctx, newUser)
    
    return response, nil
}
```

**–ü—Ä–∞–≤–∏–ª–∞ Use Cases —Å–ª–æ—è:**
- ‚úÖ –ú–û–ñ–ï–¢ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å domain —Å–ª–æ–π
- ‚úÖ –ù–ï –ó–ù–ê–ï–¢ –æ HTTP, SQL, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö
- ‚úÖ –ó–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- ‚úÖ –°–æ–¥–µ—Ä–∂–∏—Ç application-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—É—é –ª–æ–≥–∏–∫—É

### üîå Interface Adapters Layer

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `internal/interfaces/`

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- **Controllers** (HTTP handlers)
- **Presenters** (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤)
- **Gateways** (–∞–¥–∞–ø—Ç–µ—Ä—ã –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API)

**–ü—Ä–∏–º–µ—Ä - AuthController:**
```go
// internal/interfaces/controllers/auth_controller.go
func (c *AuthController) Register(w http.ResponseWriter, r *http.Request) {
    // –ê–î–ê–ü–¢–ê–¶–ò–Ø: –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç HTTP –≤ Use Case –∏ –æ–±—Ä–∞—Ç–Ω–æ
    
    // 1. HTTP ‚Üí Go struct
    var req auth.RegisterRequest
    json.NewDecoder(r.Body).Decode(&req)
    
    // 2. –í—ã–∑—ã–≤–∞–µ–º Use Case
    response, err := c.registerUC.Execute(r.Context(), req)
    
    // 3. Go struct ‚Üí HTTP
    w.Header().Set("Content-Type", "application/json")
    json.NewEncoder(w).Encode(response)
}
```

**–ü—Ä–∞–≤–∏–ª–∞ Interface Adapters —Å–ª–æ—è:**
- ‚úÖ –ú–û–ñ–ï–¢ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å usecase –∏ domain —Å–ª–æ–∏
- ‚úÖ –ó–ù–ê–ï–¢ –æ HTTP –ø—Ä–æ—Ç–æ–∫–æ–ª–µ
- ‚úÖ –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
- ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–∞–ø—Ç–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö

### üåê Infrastructure Layer (–°–∞–º—ã–π –≤–Ω–µ—à–Ω–∏–π)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `internal/infrastructure/`

**–ß—Ç–æ —Å–æ–¥–µ—Ä–∂–∏—Ç:**
- **Database implementations** (PostgreSQL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏)
- **Web server** (HTTP —Å–µ—Ä–≤–µ—Ä –∏ middleware)
- **External services** (JWT, bcrypt, API –∫–ª–∏–µ–Ω—Ç—ã)

**–ü—Ä–∏–º–µ—Ä - UserRepository:**
```go
// internal/infrastructure/database/user_repository.go
func (r *UserRepository) Save(ctx context.Context, u *user.User) error {
    // –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø: –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL
    
    query := `INSERT INTO users (email, hashed_password, name) VALUES ($1, $2, $3)`
    _, err := r.db.ExecContext(ctx, query, u.Email, u.HashedPassword, u.Name)
    return err
}
```

**–ü—Ä–∞–≤–∏–ª–∞ Infrastructure —Å–ª–æ—è:**
- ‚úÖ –ú–û–ñ–ï–¢ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –í–°–ï —Å–ª–æ–∏
- ‚úÖ –ó–ù–ê–ï–¢ –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è—Ö (PostgreSQL, bcrypt, JWT)
- ‚úÖ –†–ï–ê–õ–ò–ó–£–ï–¢ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å–ª–æ–µ–≤
- ‚úÖ –ù–ï —Å–æ–¥–µ—Ä–∂–∏—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### üîÑ –ü–æ—Ç–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    üåê INFRASTRUCTURE                        ‚îÇ
‚îÇ              (PostgreSQL, bcrypt, JWT, HTTP)               ‚îÇ
‚îÇ                           ‚îÇ                                 ‚îÇ
‚îÇ                           ‚îÇ implements                      ‚îÇ
‚îÇ                           ‚Üì                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                   üîå INTERFACE ADAPTERS                     ‚îÇ
‚îÇ                    (HTTP Controllers)                      ‚îÇ
‚îÇ                           ‚îÇ                                 ‚îÇ
‚îÇ                           ‚îÇ calls                           ‚îÇ
‚îÇ                           ‚Üì                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                     üíº USE CASES                            ‚îÇ
‚îÇ                (RegisterUseCase, LoginUseCase)             ‚îÇ
‚îÇ                           ‚îÇ                                 ‚îÇ
‚îÇ                           ‚îÇ uses                            ‚îÇ
‚îÇ                           ‚Üì                                 ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                     üèõÔ∏è DOMAIN                              ‚îÇ
‚îÇ                   (User, Link, interfaces)                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∞–≤–∏–ª–æ:** –°—Ç—Ä–µ–ª–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ **–∏–º–ø–æ—Ä—Ç–æ–≤**. –í–Ω–µ—à–Ω–∏–µ —Å–ª–æ–∏ –∑–Ω–∞—é—Ç –æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö, –Ω–æ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç!

---

## üîÑ –ò–Ω–≤–µ—Ä—Å–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: –ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ

### –ë–µ–∑ –∏–Ω–≤–µ—Ä—Å–∏–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–ü–õ–û–•–û)

```go
// ‚ùå Use Case –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
type RegisterUseCase struct {
    userRepo *PostgreSQLUserRepository  // ‚Üê –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Ç–∏–ø!
}

func (uc *RegisterUseCase) Execute(req RegisterRequest) {
    // –ü—Ä—è–º–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç PostgreSQL
    exists := uc.userRepo.ExistsInPostgreSQL(req.Email)
}
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
1. –ù–µ–ª—å–∑—è –∑–∞–º–µ–Ω–∏—Ç—å PostgreSQL –Ω–∞ MongoDB
2. –ù–µ–ª—å–∑—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î
3. Use Case –∑–Ω–∞–µ—Ç –æ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª—è—Ö PostgreSQL

### –° –∏–Ω–≤–µ—Ä—Å–∏–µ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–•–û–†–û–®–û)

```go
// ‚úÖ Use Case –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
type RegisterUseCase struct {
    userRepo user.Repository  // ‚Üê –ò–ù–¢–ï–†–§–ï–ô–° –∏–∑ domain —Å–ª–æ—è!
}

// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤ domain —Å–ª–æ–µ
type Repository interface {
    Exists(ctx context.Context, email string) (bool, error)
}
```

**–°—Ö–µ–º–∞ –∏–Ω–≤–µ—Ä—Å–∏–∏:**

**–ë–µ–∑ –∏–Ω–≤–µ—Ä—Å–∏–∏:**
```
Use Case ‚Üí PostgreSQLRepository
    ‚Üë              ‚Üë
 (–∑–Ω–∞–µ—Ç –æ)    (—Ä–µ–∞–ª–∏–∑—É–µ—Ç)
```

**–° –∏–Ω–≤–µ—Ä—Å–∏–µ–π:**
```
Use Case ‚Üí Repository Interface ‚Üê PostgreSQLRepository
    ‚Üë              ‚Üë                        ‚Üë
 (–∑–Ω–∞–µ—Ç –æ)    (–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç)              (—Ä–µ–∞–ª–∏–∑—É–µ—Ç)
```

### –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–∑ –Ω–∞—à–µ–≥–æ –∫–æ–¥–∞

**1. Domain —Å–ª–æ–π –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```go
// internal/domain/user/repository.go
package user

type Repository interface {
    Save(ctx context.Context, user *User) error
    FindByEmail(ctx context.Context, email string) (*User, error)
    Exists(ctx context.Context, email string) (bool, error)
}
```

**2. Use Case –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```go
// internal/usecase/auth/register.go
package auth

import "clean-url-shortener/internal/domain/user"

type RegisterUseCase struct {
    userRepo user.Repository  // ‚Üê –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–∑ domain!
}
```

**3. Infrastructure —Ä–µ–∞–ª–∏–∑—É–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å:**
```go
// internal/infrastructure/database/user_repository.go
package database

import "clean-url-shortener/internal/domain/user"

type UserRepository struct {
    db *DB
}

// –†–µ–∞–ª–∏–∑—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å user.Repository
func (r *UserRepository) Save(ctx context.Context, u *user.User) error {
    // PostgreSQL-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
}

func (r *UserRepository) FindByEmail(ctx context.Context, email string) (*user.User, error) {
    // PostgreSQL-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
}

func (r *UserRepository) Exists(ctx context.Context, email string) (bool, error) {
    // PostgreSQL-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
}
```

**4. DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–≤—è–∑—ã–≤–∞–µ—Ç –≤—Å–µ –≤–º–µ—Å—Ç–µ:**
```go
// pkg/di/container.go
func (c *Container) initRepositories() error {
    // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
    postgresRepo := database.NewUserRepository(c.DB)
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–∞–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å!
    c.UserRepo = postgresRepo  // user.Repository = *database.UserRepository
    
    return nil
}

func (c *Container) initUseCases() error {
    // Use Case –ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å, –Ω–µ –∑–Ω–∞—è –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
    c.RegisterUC = auth.NewRegisterUseCase(
        c.UserRepo,  // –ü–µ—Ä–µ–¥–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
        c.PasswordHasher,
        c.TokenGenerator,
    )
    return nil
}
```

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∏–Ω–≤–µ—Ä—Å–∏–∏

**1. –õ–µ–≥–∫–∞—è –∑–∞–º–µ–Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
```go
// –ú–æ–∂–µ–º –∑–∞–º–µ–Ω–∏—Ç—å PostgreSQL –Ω–∞ MongoDB
c.UserRepo = mongodb.NewUserRepository(mongoClient)

// –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
c.UserRepo = cache.NewCachedUserRepository(c.UserRepo, redisClient)

// Use Case –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è!
```

**2. –ü—Ä–æ—Å—Ç–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
```go
// –¢–µ—Å—Ç —Å –º–æ–∫-–æ–±—ä–µ–∫—Ç–æ–º
func TestRegisterUseCase(t *testing.T) {
    mockRepo := &MockUserRepository{
        ExistsFunc: func(email string) bool {
            return email == "existing@example.com"
        },
    }
    
    useCase := auth.NewRegisterUseCase(mockRepo, mockHasher, mockTokenGen)
    
    // –¢–µ—Å—Ç–∏—Ä—É–µ–º –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–π –ë–î!
    result, err := useCase.Execute(RegisterRequest{
        Email: "new@example.com",
    })
    
    assert.NoError(t, err)
    assert.NotNil(t, result)
}
```

**3. –ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å:**
```go
// –ú–æ–∂–µ–º —Å–æ–∑–¥–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
if config.Database.Type == "postgres" {
    c.UserRepo = database.NewPostgreSQLUserRepository(db)
} else if config.Database.Type == "mongodb" {
    c.UserRepo = database.NewMongoUserRepository(mongoClient)
}

// Use Cases –æ—Å—Ç–∞—é—Ç—Å—è —Ç–µ–º–∏ –∂–µ!
```

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ù–∞—à–∞ Clean Architecture –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:

### ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤
- –ú–æ–∂–µ–º –∑–∞–º–µ–Ω–∏—Ç—å `net/http` –Ω–∞ Gin –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è Use Cases
- –ú–æ–∂–µ–º –¥–æ–±–∞–≤–∏—Ç—å gRPC API —Ä—è–¥–æ–º —Å HTTP

### ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç—å
- –ö–∞–∂–¥—ã–π —Å–ª–æ–π –º–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ
- –õ–µ–≥–∫–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–æ–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

### ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- –ú–æ–∂–µ–º –∑–∞–º–µ–Ω–∏—Ç—å PostgreSQL –Ω–∞ MongoDB
- –ú–æ–∂–µ–º –¥–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- –ú–æ–∂–µ–º –∑–∞–º–µ–Ω–∏—Ç—å bcrypt –Ω–∞ argon2
- –ú–æ–∂–µ–º –∑–∞–º–µ–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π JWT –Ω–∞ –≤–Ω–µ—à–Ω–∏–π —Å–µ—Ä–≤–∏—Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

### ‚úÖ –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∑–∞—â–∏—â–µ–Ω—ã
- –î–æ–º–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏—Ö –¥–µ—Ç–∞–ª–µ–π
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤–æ –≤–Ω–µ—à–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É

### üîÑ –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```
Infrastructure ‚Üí Interfaces ‚Üí Use Cases ‚Üí Domain
     ‚Üë              ‚Üë            ‚Üë         ‚Üë
(PostgreSQL,    (HTTP,       (Business  (Business
 bcrypt,        JSON,        Logic,     Rules,
 JWT)           REST)        Orchestr.) Entities)
```

**–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø:** –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–ª–æ–∏ –ù–ï –ó–ù–ê–Æ–¢ –æ –≤–Ω–µ—à–Ω–∏—Ö. –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä—å!

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞–º –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º, —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ —Ä–∞–∑–≤–∏–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–µ–∑ –Ω–∞—Ä—É—à–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏.